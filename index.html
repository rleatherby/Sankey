<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>
  body { background-color: white; }
</style>

<!-- Load libraries from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.9.1/d3.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/timelyportfolio/sankeyD3@master/sankey.js"></script>

</head>
<body>

<div style="
    display:flex;
    justify-content:space-between;
    align-items:center;
    width:800px;
    margin-bottom:5px;
  ">
  <div style="font-weight:bold;">Aetiology of index MLLA</div>
  <div style="font-weight:bold; text-align:center; flex:1;">Aetiology of contralateral limb disease</div>
  <div style="font-weight:bold; text-align:right;">Contralateral limb outcome</div>
</div>

<div id="sankey" style="width:800px;height:500px;"></div>

<script>
// Full nodes
const nodes = [
  {name:"ALI "},{name:"DFI "},{name:"CLTI "},{name:"A on CLI "},{name:"Other "},
  {name:"Other  "},{name:"DFI  "},{name:"CLTI  "},{name:"ALI  "},{name:"Claudication  "},
  {name:"A on CLI  "},{name:"Revascularisation**"},{name:"Minor amputation or debridement alone"},
  {name:"Secondary MLLA*"},{name:"No intervention"},{name:"Primary MLLA"}
];

// Full links (copied from your JSON)
const links = [
{"source":0,"target":5,"value":1},{"source":1,"target":6,"value":1},{"source":1,"target":6,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":1,"target":7,"value":1},{"source":0,"target":7,"value":1},
{"source":1,"target":7,"value":1},{"source":0,"target":6,"value":1},{"source":2,"target":7,"value":1},
{"source":0,"target":5,"value":1},{"source":1,"target":7,"value":1},{"source":0,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":0,"target":5,"value":1},{"source":0,"target":8,"value":1},
{"source":2,"target":7,"value":1},{"source":1,"target":7,"value":1},{"source":0,"target":8,"value":1},
{"source":0,"target":8,"value":1},{"source":2,"target":5,"value":1},{"source":1,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":0,"target":5,"value":1},{"source":1,"target":6,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":0,"target":8,"value":1},{"source":1,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":1,"target":6,"value":1},{"source":1,"target":7,"value":1},{"source":1,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":0,"target":5,"value":1},
{"source":3,"target":7,"value":1},{"source":1,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":0,"target":5,"value":1},{"source":2,"target":7,"value":1},{"source":3,"target":7,"value":1},
{"source":1,"target":7,"value":1},{"source":1,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":0,"target":5,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":3,"target":7,"value":1},{"source":3,"target":7,"value":1},{"source":1,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":3,"target":7,"value":1},{"source":1,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":1,"target":7,"value":1},
{"source":3,"target":7,"value":1},{"source":1,"target":7,"value":1},{"source":0,"target":5,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":3,"target":7,"value":1},
{"source":4,"target":7,"value":1},{"source":1,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":1,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":0,"target":7,"value":1},{"source":1,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":3,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":3,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":1,"target":7,"value":1},
{"source":3,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":3,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":1,"target":7,"value":1},
{"source":3,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":3,"target":7,"value":1},
{"source":0,"target":7,"value":1},{"source":0,"target":7,"value":1},{"source":1,"target":7,"value":1},
{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1},{"source":2,"target":7,"value":1}
 // NOTE: Add remaining links if needed
];

// Create Sankey layout
const sankey = d3.sankey()
  .nodeWidth(30)
  .nodePadding(10)
  .size([800, 500]);

const graph = sankey({
  nodes: nodes.map(d => Object.assign({}, d)),
  links: links.map(d => Object.assign({}, d))
});

const svg = d3.select("#sankey").append("svg")
  .attr("width", 800)
  .attr("height", 500);

// Draw links
svg.append("g")
  .attr("fill", "none")
  .attr("stroke-opacity", 0.5)
  .selectAll("path")
  .data(graph.links)
  .join("path")
    .attr("d", d3.sankeyLinkHorizontal())
    .attr("stroke", "#69b3a2")
    .attr("stroke-width", d => Math.max(1, d.width));

// Draw nodes
svg.append("g")
  .selectAll("rect")
  .data(graph.nodes)
  .join("rect")
    .attr("x", d => d.x0)
    .attr("y", d => d.y0)
    .attr("height", d => d.y1 - d.y0)
    .attr("width", d => d.x1 - d.x0)
    .style("fill", "#404080")
    .style("stroke", "#000");

// Node labels
svg.append("g")
  .selectAll("text")
  .data(graph.nodes)
  .join("text")
    .attr("x", d => d.x0 - 6)
    .attr("y", d => (d.y1 + d.y0)/2)
    .attr("dy", "0.35em")
    .attr("text-anchor", "end")
    .text(d => d.name)
    .filter(d => d.x0 < 400)
      .attr("x", d => d.x1 + 6)
      .attr("text-anchor", "start");

</script>

</body>
</html>
